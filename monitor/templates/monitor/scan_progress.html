{% extends "monitor/base.html" %}
{% block title %}Scanning Network...{% endblock %}

{% block content %}
<h2 class="text-center">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏...</h2>

<!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
<div class="progress" style="height: 30px; margin: 20px 0;">
  <div id="scan-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-info"
       role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<!-- –ó–∞–±–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã -->
<p id="scan-status" class="text-center mt-3" style="font-size: 1.2rem;"></p>

<script>
    const messages = [
        "–ò—â–µ–º —Å–±–µ–∂–∞–≤—à–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞... üèÉ‚Äç‚ôÇÔ∏è",
        "–¢–∞–Ω—Ü—É–µ–º —Å –±—É–±–Ω–æ–º... ü™ò",
        "–•–≤–∞–ª–∏–º –∞–¥–º–∏–Ω–∞... üôå",
        "–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–µ—á–µ–Ω—å–∫–∏ —É —Å–µ—Ä–≤–µ—Ä–∞... üç™",
        "–ü–æ–¥–º–∏–≥–∏–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—É... üòâ",
        "–ù–∞—Ö–æ–¥–∏–º –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã... üì¶",
        "–ö–∞–±–µ–ª—å –≤–æ—Ç–∫–Ω—É—Ç? ü™õ",
        "–ö–æ—Ä–º–∏–º IP-–∞–¥—Ä–µ—Å–∞... ü•£",
        "–£–≥–æ–≤–∞—Ä–∏–≤–∞–µ–º –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞—Ç—å... üôè",
        "–í—ã–∑—ã–≤–∞–µ–º —Å–µ—Ç–µ–≤–æ–≥–æ —à–∞–º–∞–Ω–∞... üßô‚Äç‚ôÇÔ∏è",
        "–ü–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –≤—Å—ë, —á—Ç–æ –º–æ–∂–Ω–æ... üîÑ",
        "–î–µ–ª–∞–µ–º –≤–∏–¥, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç... ü§î",
        "–ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞–∫–µ—Ç–Ω—ã–µ –≥–æ–Ω–∫–∏... üèéÔ∏è",
        "–ò—â–µ–º –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–∏–Ω–≥... üìâ",
    ];

    let i = 0;
    let progress = 0;
    const scanStatusDiv = document.getElementById("scan-status");
    const progressBar = document.getElementById("scan-progress-bar");

    function updateStatus() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        scanStatusDiv.textContent = messages[i % messages.length];

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        progress = Math.min(progress + 7, 100);
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
        i++;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        fetch("{% url 'scan_status' %}")
            .then(response => response.json())
            .then(data => {
                if (!data.scan_in_progress) {
                    window.location.href = "{% url 'home' %}";
                } else {
                    setTimeout(updateStatus, 1500);
                }
            })
            .catch(error => console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:", error));
    }

    updateStatus();
</script>

{% endblock %}
